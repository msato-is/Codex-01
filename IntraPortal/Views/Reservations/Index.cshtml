@model List<IntraPortal.Models.Reservation>
@{
  ViewData["Title"] = "会議室予約";
  var rooms = (IEnumerable<IntraPortal.Models.MeetingRoom>)ViewBag.Rooms;
  var date = (DateOnly)ViewBag.Date;
  int? roomId = (int?)ViewBag.RoomId;
  var free = (List<(TimeOnly start, TimeOnly end)>)ViewBag.FreeSlots;
}

<form method="get" class="row g-2 align-items-end mb-3">
  <div class="col-md-4">
    <label class="form-label">日付</label>
    <input type="date" name="date" value="@date.ToString("yyyy-MM-dd")" class="form-control" />
  </div>
  <div class="col-md-4">
    <label class="form-label">会議室</label>
    <select name="roomId" class="form-select">
      <option value="">（全室）</option>
      @foreach (var r in rooms){ <option value="@r.Id" selected="@(roomId==r.Id)">@r.Name (@r.Capacity)</option> }
    </select>
  </div>
  <div class="col-md-4"><button class="btn btn-primary">表示</button></div>
</form>

<div class="row g-3">
  <div class="col-md-6">
    <h5>予約一覧</h5>
    <table class="table table-sm">
      <thead><tr><th>会議室</th><th>時間</th><th>目的</th><th>予約者</th><th></th></tr></thead>
      <tbody>
      @foreach (var r in Model){
        <tr>
          <td>@r.Room?.Name</td>
          <td>@r.StartTime - @r.EndTime</td>
          <td>@r.Purpose</td>
          <td>@r.ReservedBy</td>
          <td>
            <form method="post" asp-action="Delete">
              <input type="hidden" name="id" value="@r.Id" />
              <input type="hidden" name="reservedBy" value="@r.ReservedBy" />
              <button class="btn btn-outline-danger btn-sm">削除</button>
            </form>
          </td>
        </tr>
      }
      </tbody>
    </table>
  </div>
  <div class="col-md-6">
    <h5>空き時間帯（@date: 9:00-18:00）</h5>
    <ul>
      @foreach (var s in free){ <li>@s.start - @s.end</li> }
      @if (!free.Any()){ <li>空きなし</li> }
    </ul>

    <h5 class="mt-3">新規予約</h5>
    <form method="post" asp-action="Create">
      <div class="mb-2">
        <label class="form-label">会議室</label>
        <select name="RoomId" class="form-select">
          @foreach (var r in rooms){ <option value="@r.Id">@r.Name (@r.Capacity)</option> }
        </select>
      </div>
      <div class="mb-2">
        <label class="form-label">日付</label>
        <input type="date" name="Date" value="@date.ToString("yyyy-MM-dd")" class="form-control" />
      </div>
      <div class="mb-2">
        <label class="form-label">開始</label>
        <input type="time" name="StartTime" value="09:00" class="form-control" />
      </div>
      <div class="mb-2">
        <label class="form-label">終了</label>
        <input type="time" name="EndTime" value="10:00" class="form-control" />
      </div>
      <div class="mb-2">
        <label class="form-label">目的</label>
        <input name="Purpose" class="form-control" />
      </div>
      <div class="mb-2">
        <label class="form-label">予約者</label>
        <input name="ReservedBy" class="form-control" required />
      </div>
      <button class="btn btn-success">保存</button>
    </form>
  </div>
</div>

